[build-system]
requires = ["setuptools", "Cython"]
build-backend = "setuptools.build_meta"

[tool.cibuildwheel]
test-command = "python {project}/test/noddi.py"
test-skip = "*-win32 cp38-macosx_arm64"
build-verbosity = 3

[tool.cibuildwheel.windows]
before-build = "pip install delvewheel"
repair-wheel-command = "delvewheel repair --add-path .\\OpenBLAS-0.3.21\\bin -w {dest_dir} -v {wheel}"
before-test = "7z x test/demo.zip -otest/demo"

[tool.cibuildwheel.macos]
before-all = [
    "tar -xzf OpenBLAS-0.3.21.tar.gz",
    "make clean",
    "make -C OpenBLAS-0.3.21 DYNAMIC_ARCH=1"
]
repair-wheel-command = "DYLD_LIBRARY_PATH=$(pwd)/OpenBLAS-0.3.21 delocate-wheel --require-archs {delocate_archs} -w {dest_dir} -v {wheel}"
before-test = "7z x test/demo.zip -otest/demo"

[tool.cibuildwheel.linux]
before-all = [
    "tar -xzf OpenBLAS-0.3.21.tar.gz",
    "make clean",
    "make -C OpenBLAS-0.3.21 DYNAMIC_ARCH=1"
]
repair-wheel-command = "LD_LIBRARY_PATH=$(pwd)/OpenBLAS-0.3.21 auditwheel repair -w {dest_dir} -v {wheel}"
before-test = "unzip test/demo.zip -d test/demo"
