name: Download MacOS arm64 wheels
run-name: Download MacOS arm64 wheels on branch '${{ github.ref_name }}'
on:
  workflow_dispatch:
    inputs:
      cirrus_build_id:
        description: 'CirrusCI build ID'
        required: true
        type: number
      check_run_id:
        description: Check run ID
        required: true
        type: number
      passed:
        description: 'CirrusCI build is passed'
        required: true
        type: boolean
jobs:
  download_wheels:
    name: arm64 # TODO change name?
    if: ${{ inputs.passed }} # TODO: add github.ref_name == 'main'
    runs-on: ubuntu-20.04
    # TODO: use 7z
    steps:
      - name: Download from Cirrus CI
        run: |
          curl -L -o wheels_macos_arm64.zip https://api.cirrus-ci.com/v1/artifact/build/${{ inputs.cirrus_build_id }}/build_macos_wheels/wheels_macos_arm64.zip
          unzip wheels_macos_arm64.zip
      
      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: wheels_macos_arm64
          path: ./wheelhouse/*.whl

      - name: Update check
        run: |
          curl -X PATCH -H "Accept: application/vnd.github+json" -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" -H "X-GitHub-Api-Version: 2022-11-28" https://api.github.com/repos/nightwnvol/amico_gh_actions/check-runs/${{ inputs.check_run_id }} -d '{"name":"arm64_check","status":"completed","conclusion":"success"}'
